<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Intake Chatbot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
</head>
<body>
    <div id="chat-container">
        <div id="chat-messages"></div>
        <form id="chat-form">
            <input type="text" id="user-input" placeholder="Type your message here..." autocomplete="off">
            <button type="submit">Send</button>
        </form>
        <button id="end-chat">End Chat</button>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        const socket = io();
        let sessionId;

        socket.on('connect', () => {
            console.log('Connected to server');
        });

        socket.on('session_id', (id) => {
            sessionId = id;
            console.log('Received session ID:', sessionId);
        });

        socket.on('message', (data) => {
            appendMessage(data.role, data.content);
        });

        socket.on('chat_ended', (data) => {
            alert(`Chat ended. Transcript number: ${data.transcript_number}`);
        });

        document.getElementById('chat-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            if (message) {
                appendMessage('user', message);
                socket.emit('message', { session_id: sessionId, message: message });
                input.value = '';
            }
        });

        document.getElementById('end-chat').addEventListener('click', () => {
            socket.emit('end_chat', { session_id: sessionId });
        });

        function appendMessage(role, content) {
            const messagesDiv = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            messageDiv.textContent = content;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
    </script>
</body>
</html>